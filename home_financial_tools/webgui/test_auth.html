<!DOCTYPE html>
<html>

<head>
    <title>Auth Test</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>

<body>
    <h1>Authentication Test</h1>
    <div id="results"></div>

    <script>
        const results = document.getElementById('results');

        async function test() {
            results.innerHTML = '<p>Testing authentication flow...</p>';

            try {
                // Test 1: Login
                results.innerHTML += '<p>1. Testing login...</p>';
                const loginResponse = await axios.post('/api/login', {
                    username: 'admin',
                    password: 'admin123'
                });
                results.innerHTML += `<p style="color: green">✓ Login successful! Token: ${loginResponse.data.token.substring(0, 20)}...</p>`;

                // Test 2: Set cookie
                document.cookie = `auth_token=${loginResponse.data.token};path=/`;
                results.innerHTML += '<p style="color: green">✓ Cookie set</p>';

                // Test 3: Test authenticated request
                results.innerHTML += '<p>2. Testing authenticated request...</p>';
                const corpResponse = await axios.get('/api/corporation', {
                    headers: {
                        'X-Auth-Token': loginResponse.data.token
                    }
                });
                results.innerHTML += `<p style="color: green">✓ Authenticated request successful!</p>`;

                // Test 4: Test without token
                results.innerHTML += '<p>3. Testing request without token...</p>';
                try {
                    await axios.get('/api/corporation');
                    results.innerHTML += '<p style="color: red">✗ Should have failed but didn\'t!</p>';
                } catch (e) {
                    if (e.response && e.response.status === 403) {
                        results.innerHTML += '<p style="color: green">✓ Correctly rejected unauthenticated request (403)</p>';
                    } else {
                        results.innerHTML += `<p style="color: orange">? Got unexpected error: ${e.message}</p>`;
                    }
                }

                results.innerHTML += '<h2 style="color: green">All tests passed!</h2>';

            } catch (error) {
                results.innerHTML += `<p style="color: red">✗ Error: ${error.message}</p>`;
                if (error.response) {
                    results.innerHTML += `<p>Status: ${error.response.status}</p>`;
                    results.innerHTML += `<p>Data: ${JSON.stringify(error.response.data)}</p>`;
                }
            }
        }

        test();
    </script>
</body>

</html>